<!DOCTYPE html>
<html>
<head>
    <title>Theo d√µi c√¢y tr·ªìng</title>
    <style>
        /* K·∫ø th·ª´a CSS t·ª´ dashboard */
        .delete-btn {
            background-color: #ff4444;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
        }
        .delete-btn:hover {
            background-color: #cc0000;
        }
                #sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 60px;
            height: 100%;
            background: #000;
            padding: 15px 0;
            transition: 0.3s;
            z-index: 1001;
        }

        #sidebar:hover {
            width: 200px;
        }

        .nav-icon {
            color: white;
            font-size: 24px;
            padding: 20px;
            cursor: pointer;
            white-space: nowrap;
            overflow: hidden;
        }
        body { margin: 0; font-family: Arial; }
        #sidebar { /* Gi·ªëng dashboard */ }
        .container { max-width: 1200px; margin: 20px auto; padding: 20px; }
        .plant-form { background: #f5f5f5; padding: 20px; border-radius: 10px; }
        .form-group { margin-bottom: 15px; }
        input, textarea { width: 100%; padding: 8px; }
        .alert-box { background: #fff3cd; padding: 15px; margin-bottom: 20px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #ddd; }
        .status-dropdown { padding: 5px; border-radius: 4px; }
    </style>
</head>
<body>
    <div id="sidebar">
        <div class="nav-icon" onclick="window.location.href='/'">‚ò∞ Data</div>
        <div class="nav-icon" onclick="window.location.href='/predict'">üåø Plant Check</div>
        <div class="nav-icon" onclick="window.location.href='/plant_tracker'">üå± Theo d√µi c√¢y</div>
    </div>

    <div class="container">
        <h1>Qu·∫£n l√Ω c√¢y tr·ªìng üåø</h1>
        <!-- Ph·∫ßn c·∫£nh b√°o -->
        <div class="alert-box" id="alerts-section">
            <h3>‚ö†Ô∏è C·∫£nh b√°o</h3>
            <div id="alerts-list"></div>
        </div>

        <!-- Form th√™m c√¢y m·ªõi -->
        <div class="plant-form">
            <h2>Th√™m c√¢y m·ªõi</h2>
            <div class="form-group">
                <label>T√™n c√¢y:</label>
                <input type="text" id="plant-name" required>
            </div>
            <div class="form-group">
                <label>S·ªë ng√†y thu ho·∫°ch d·ª± ki·∫øn:</label>
                <input type="number" id="growth-days" required>
            </div>
            <div class="form-group">
                <label>Ghi ch√∫:</label>
                <textarea id="plant-notes"></textarea>
            </div>
            <button onclick="addNewPlant()" class="control-btn">Th√™m c√¢y</button>
        </div>

        <!-- B·∫£ng d·ªØ li·ªáu -->
        <h2>Danh s√°ch c√¢y tr·ªìng</h2>
        <table id="plants-table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>T√™n c√¢y</th>
                    <th>Ng√†y tr·ªìng</th>
                    <th>Ng√†y thu ho·∫°ch</th>
                    <th>Tr·∫°ng th√°i</th>
                    <th>Thao t√°c</th>
                </tr>
            </thead>
            <tbody id="plants-body"></tbody>
        </table>
    </div>

    <script>
        // Load d·ªØ li·ªáu ban ƒë·∫ßu

        window.onload = function() {
            loadPlants();
            loadAlerts();
        }

        function loadPlants() {
            fetch('/api/plants')
                .then(response => response.json())
                .then(data => {
                    renderPlants(data.plants);
                })
                .catch(error => console.error('Error loading plants:', error));
        }

        function renderPlants(plants) {
            const tbody = document.getElementById('plants-body');
            tbody.innerHTML = plants.map(plant => `
                <tr>
                    <td>${plant.plant_id}</td>
                    <td>${plant.plant_name}</td>
                    <td>${plant.planting_date}</td>
                    <td>${plant.expected_harvest_date}</td>
                    <td>
                        <select class="status-dropdown"
                                onchange="updateStatus(${plant.plant_id}, this.value)">
                            <option value="growing" ${plant.status === 'growing' ? 'selected' : ''}>ƒêang ph√°t tri·ªÉn</option>
                            <option value="harvested" ${plant.status === 'harvested' ? 'selected' : ''}>ƒê√£ thu ho·∫°ch</option>
                        </select>
                    </td>
                    <td>
                        <button onclick="showDetails(${plant.plant_id})">Chi ti·∫øt</button>
                        <button onclick="deletePlant(${plant.plant_id})" class="delete-btn">X√≥a</button>
                    </td>
                </tr>
            `).join('');
        }

        function loadAlerts() {
            fetch('/plant_tracker')
                .then(response => response.text())
                .then(html => {
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(html, 'text/html');
                    const alerts = JSON.parse(doc.getElementById('alerts-data').textContent);
                    renderAlerts(alerts);
                });
        }

        function renderAlerts(alerts) {
            const alertsList = document.getElementById('alerts-list');
            alertsList.innerHTML = alerts.map(alert => `
                <div class="alert-item">
                    <strong>${alert.plant_name}</strong>: ${alert.message}
                </div>
            `).join('');
        }

        function addNewPlant() {
            const plantData = {
                plant_name: document.getElementById('plant-name').value,
                growth_days: document.getElementById('growth-days').value,
                notes: document.getElementById('plant-notes').value
            };

            fetch('/add_plant', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(plantData)
            })
            .then(response => response.json())
            .then(data => {
                if(data.success) {
                    alert('Th√™m c√¢y th√†nh c√¥ng!');
                    loadPlants();
                }
            });
        }
        function deletePlant(plantId) {
            if (confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a c√¢y n√†y?')) {
                fetch('/delete_plant', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({plant_id: plantId})
                })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            alert('X√≥a c√¢y th√†nh c√¥ng!');
                            loadPlants();
                            loadAlerts();
                        } else {
                            alert('Kh√¥ng th·ªÉ x√≥a c√¢y. Vui l√≤ng th·ª≠ l·∫°i!');
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        alert('ƒê√£ x·∫£y ra l·ªói khi x√≥a c√¢y');
                    });
            }
        }

        function updateStatus(plantId, newStatus) {
            fetch('/update_plant_status', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    plant_id: plantId,
                    status: newStatus
                })
            })
            .then(response => response.json())
            .then(data => {
                if(data.success) {
                    loadPlants();
                    loadAlerts();
                }
            });
        }

        function showDetails(plantId) {
            window.location.href = `/plant_details/${plantId}`;
        }
    </script>
</body>
</html>